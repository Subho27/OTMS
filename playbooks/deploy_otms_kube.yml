---
- name: Deploy OTMS application
  hosts: localhost
  gather_facts: False
  tasks:
    # - name: Ensure Docker is installed
    #   apt:
    #     name: docker.io
    #     state: present
    #   become: true

    # - name: Ensure Docker Compose is installed
    #   get_url:
    #     url: https://github.com/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m`
    #     dest: /usr/local/bin/docker-compose
    #     mode: '0755'
    #   become: true
    #   when: ansible_distribution == "Ubuntu"

    - name: Pull frontend from Docker Hub
      shell: docker pull subhodip703/ui-otms:0.0.1

    - name: Pull backend from Docker Hub
      shell: docker pull subhodip703/api-otms:0.0.1

    - name: Deploying Database ConfigMap File
      kubernetes.core.k8s:
        kubeconfig: /etc/ansible/kube.config
        state: present
        src: ./k8s-deploy/db-config.yml
    
    - name: Deploying Database
      kubernetes.core.k8s:
        kubeconfig: /etc/ansible/kube.config
        state: present
        src: ./k8s-deploy/db-deployment-service.yml
